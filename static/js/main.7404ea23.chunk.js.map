{"version":3,"sources":["lib/firebase.js","components/product/product.js","views/products.js","components/data-item/data-item.js","views/home.js","App.js","reportWebVitals.js","index.js"],"names":["app","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","auth","getAuth","db","getDatabase","Product","productData","createProduct","editProduct","deleteProduct","useState","name","setName","url","setUrl","site","setSite","localCreateProduct","a","alert","message","className","htmlFor","id","placeholder","type","value","onChange","e","target","onClick","productsRef","ref","Products","batchProductsJson","setBatchProductsJson","products","setProducts","useEffect","onChildAdded","query","productListSnap","newProduct","key","val","existingProducts","onChildRemoved","filter","p","get","orderByChild","equalTo","exists","Error","push","createAllProducts","JSON","parse","Promise","all","map","console","log","set","productId","remove","DataItem","dataItem","loading","isInStock","alt","src","productPrice","productName","format","Date","date","productSite","rel","href","productUrl","dataRef","stockRef","last50DataRef","limitToLast","lastHourInStock","Home","data","setData","inStockItems","setInStockItems","setLoading","snapshot","addData","addInStock","onChildChanged","replaceInStock","replaceData","newItems","curData","copy","findIndex","cd","sort","b","parseFloat","d","App","loggedIn","setLoggedIn","isAdmin","setIsAdmin","onAuthStateChanged","user","uid","signOut","signInWithRedirect","GoogleAuthProvider","to","path","element","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.7404ea23.chunk.js","sourcesContent":["import { initializeApp } from \"@firebase/app\"\r\nimport { getAuth } from \"@firebase/auth\"\r\nimport { getDatabase } from \"@firebase/database\"\r\n\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyD4XxIuiekhE84uh7_IIVX8Fzf3wXYCcDA\",\r\n  authDomain: \"price-tracker-1c428.firebaseapp.com\",\r\n  databaseURL: \"https://price-tracker-1c428.firebaseio.com\",\r\n  projectId: \"price-tracker-1c428\",\r\n  storageBucket: \"price-tracker-1c428.appspot.com\",\r\n  messagingSenderId: \"371469893400\",\r\n  appId: \"1:371469893400:web:661c8956a419487ddc286d\",\r\n  measurementId: \"G-GJBMLVW97M\"\r\n};\r\n\r\nexport const app = initializeApp(firebaseConfig)\r\nexport const auth = getAuth(app)\r\nexport const db = getDatabase(app)","import { useState } from 'react'\r\nimport './product.scss'\r\n\r\nexport function Product({ productData, createProduct, editProduct, deleteProduct }) {\r\n  const [name, setName] = useState(productData?.name || '')\r\n  const [url, setUrl] = useState(productData?.url || '')\r\n  const [site, setSite] = useState(productData?.site || '')\r\n\r\n  const localCreateProduct = async () => {\r\n    try {\r\n      await createProduct({ name, url, site })\r\n      setName('')\r\n      setUrl('')\r\n      setSite('')\r\n    } catch (e) {\r\n      alert('No se ha podido crear el producto: \\n' + e.message)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <article className=\"productItem\">\r\n      <div className=\"fields\">\r\n        <div className=\"field\">\r\n          <label htmlFor={`${productData?.id}_name`} className=\"fieldLabel\">Nombre</label>\r\n          <input placeholder=\"Nombre del producto\" id={`${productData?.id}_name`} type=\"text\" value={name} onChange={e => setName(e.target.value)} />\r\n        </div>\r\n        <div className=\"field\">\r\n          <label htmlFor={`${productData?.id}_site`} className=\"fieldLabel\">Site</label>\r\n          <input placeholder=\"Web del producto\" id={`${productData?.id}_site`} type=\"text\" value={site} onChange={e => setSite(e.target.value)} />\r\n        </div>\r\n        <div className=\"field\">\r\n          <label htmlFor={`${productData?.id}_url`} className=\"fieldLabel\">URL</label>\r\n          <input placeholder=\"URL del producto\" id={`${productData?.id}_url`} type=\"text\" value={url} onChange={e => setUrl(e.target.value)} />\r\n        </div>\r\n      </div>\r\n      <div className=\"actions\">\r\n        {createProduct ?\r\n          <button className=\"blue\" type=\"button\" onClick={() => localCreateProduct()}>Crear</button> :\r\n          <>\r\n            <button className=\"blue\" type=\"button\" onClick={() => editProduct({ id: productData?.id, name, url, site })}>Guardar</button>\r\n            <button className=\"red\" type=\"button\" onClick={() => deleteProduct(productData?.id)}>Eliminar</button>\r\n          </>\r\n        }\r\n      </div>\r\n    </article>\r\n  )\r\n}","import { equalTo, get, onChildAdded, onChildRemoved, orderByChild, push, query, ref, remove, set } from '@firebase/database'\r\nimport { useEffect, useState } from 'react'\r\nimport { db } from '../lib/firebase'\r\nimport { Product } from '../components/product/product';\r\n\r\nconst productsRef = ref(db, '/products')\r\n\r\nexport function Products() {\r\n\r\n  const [batchProductsJson, setBatchProductsJson] = useState([])\r\n  const [products, setProducts] = useState([])\r\n\r\n  useEffect(() => {\r\n    onChildAdded(query(productsRef), productListSnap => {\r\n      const newProduct = {\r\n        id: productListSnap.key,\r\n        ...productListSnap.val(),\r\n      }\r\n      setProducts(existingProducts => [newProduct, ...existingProducts])\r\n    })\r\n    onChildRemoved(query(productsRef), productListSnap => {\r\n      setProducts(existingProducts => [...existingProducts.filter(p => p.id !== productListSnap.key)])\r\n    })\r\n  }, [])\r\n\r\n  const createProduct = async productData => {\r\n    // Check if product with URL exists already\r\n    const existingItem = await get(query(productsRef, orderByChild('url'), equalTo(productData.url)))\r\n    if (existingItem.exists()) throw new Error(`Ya existe un producto con la URL \"${productData.url}\"`)\r\n    push(productsRef, {\r\n      name: productData.name,\r\n      site: productData.site,\r\n      url: productData.url,\r\n    })\r\n  }\r\n\r\n  const createAllProducts = async () => {\r\n    const products = JSON.parse(batchProductsJson)\r\n    try {\r\n      await Promise.all(products.map(p => createProduct(p)))\r\n    } catch (e) {\r\n      console.log('this failed: ', e.message)\r\n    }\r\n  }\r\n\r\n  const editProduct = productData => {\r\n    set(ref(db, `/products/${productData.id}`), {\r\n      name: productData.name,\r\n      site: productData.site,\r\n      url: productData.url,\r\n    })\r\n  }\r\n\r\n  const deleteProduct = productId => {\r\n    remove(ref(db, `/products/${productId}`))\r\n  }\r\n\r\n  return (\r\n    <div className=\"productsPage\">\r\n      <h1 className=\"heading\">Productos</h1>\r\n      <h2 className=\"subheading\">Crear productos en masa</h2>\r\n      <code>{`JSON.stringify([...document.querySelectorAll('.product-card')].map(pc => ({name: pc.parentNode.dataset.name, url: pc.parentNode.getAttribute('href'), site: 'pccomponentes' })))`}</code>\r\n      <textarea onChange={e => setBatchProductsJson(e.target.value)} value={batchProductsJson}></textarea>\r\n      <button className=\"blue\" type=\"button\" onClick={() => createAllProducts()}>Crear todos</button>\r\n      <h2 className=\"subheading\">Crear producto</h2>\r\n      <Product createProduct={createProduct} />\r\n      <h2 className=\"subheading\">Productos actuales</h2>\r\n      <div className=\"productList\">\r\n        {products.map(p => <Product productData={p} editProduct={editProduct} deleteProduct={deleteProduct} key={p.id} />)}\r\n      </div>\r\n    </div>\r\n  )\r\n}","import { format } from \"timeago.js\";\r\nimport \"./data-item.scss\"\r\n\r\nexport function DataItem({ dataItem }) {\r\n  return (\r\n    <div className={`dataItem${dataItem.loading ? ' loading' : dataItem.isInStock ? ' inStock' : ' notInStock'}`} key={dataItem.key}>\r\n      <div className=\"leftContent\">\r\n        <header className=\"headerContent\">\r\n          <span>{dataItem.loading ? <img alt=\"\" className=\"loadingSpinner\" src=\"/stock-checker-site/loading.svg\" /> : dataItem.productPrice ? dataItem.isInStock ? '✔️' : '❌' : '❔'}</span>\r\n          <span className=\"name\">{dataItem.productName}</span>\r\n        </header>\r\n        <div className=\"smallContent\">\r\n          <span className=\"timestamp\">{format(new Date(dataItem.date), 'es_ES')}</span>\r\n          <span className=\"site\">- @{dataItem.productSite}</span>\r\n        </div>\r\n      </div>\r\n      <div className=\"rightContent\">\r\n        <span className=\"price\">{dataItem.productPrice ? dataItem.productPrice : dataItem.loading ? <img alt=\"\" className=\"loadingSpinner\" src=\"/stock-checker-site/loading.svg\" /> : '❔'} EUR</span>\r\n        <a rel=\"noreferrer\" target=\"_blank\" href={dataItem.productUrl} className=\"visitButton\">🔗 Visit</a>\r\n      </div>\r\n    </div>\r\n  )\r\n}","import { onChildAdded, onChildRemoved, query, ref, limitToLast, onChildChanged } from '@firebase/database'\r\nimport { useEffect, useState } from 'react'\r\nimport { DataItem } from '../components/data-item/data-item'\r\nimport { db } from '../lib/firebase'\r\n\r\nconst dataRef = ref(db, '/data')\r\nconst stockRef = ref(db, '/latestStock')\r\nconst last50DataRef = query(dataRef, limitToLast(50))\r\nconst lastHourInStock = query(stockRef, limitToLast(50))\r\n\r\nexport function Home() {\r\n\r\n  const [data, setData] = useState([])\r\n  const [inStockItems, setInStockItems] = useState([])\r\n  const [loading, setLoading] = useState(false)\r\n\r\n  useEffect(() => {\r\n    onChildRemoved(query(ref(db, '/latestStock')), productListSnap => {\r\n      setInStockItems(existingProducts => [...existingProducts.filter(p => p.id !== productListSnap.key)])\r\n    })\r\n    setLoading(true)\r\n    onChildAdded(last50DataRef, (snapshot) => {\r\n      const data = {\r\n        id: snapshot.key,\r\n        ...snapshot.val(),\r\n      }\r\n      setLoading(false)\r\n      addData([data])\r\n    })\r\n    onChildAdded(lastHourInStock, (snapshot) => {\r\n      const data = {\r\n        id: snapshot.key,\r\n        ...snapshot.val(),\r\n      }\r\n      addInStock([data])\r\n    })\r\n    onChildChanged(lastHourInStock, (snapshot) => {\r\n      const data = {\r\n        id: snapshot.key,\r\n        ...snapshot.val(),\r\n      }\r\n      replaceInStock(data)\r\n    })\r\n    onChildChanged(last50DataRef, (snapshot) => {\r\n      const data = {\r\n        id: snapshot.key,\r\n        ...snapshot.val(),\r\n      }\r\n      replaceData(data)\r\n    })\r\n  }, [])\r\n\r\n  const addData = newItems => {\r\n    setData(curData => [...curData, ...newItems])\r\n  }\r\n\r\n  const addInStock = newItems => {\r\n    setInStockItems(curData => [...curData, ...newItems])\r\n  }\r\n\r\n  const replaceData = dataItem => {\r\n    setData(curData => {\r\n      const copy = [...curData]\r\n      copy[copy.findIndex(cd => cd.id === dataItem.id)] = dataItem\r\n      return copy\r\n    })\r\n  }\r\n\r\n  const replaceInStock = dataItem => {\r\n    setInStockItems(curData => {\r\n      const copy = [...curData]\r\n      copy[copy.findIndex(cd => cd.id === dataItem.id)] = dataItem\r\n      return copy\r\n    })\r\n  }\r\n\r\n  return (\r\n    <div className=\"homePage\">\r\n      <h1 className=\"heading\">En stock</h1>\r\n      <div className=\"data\">\r\n        {inStockItems.sort((a, b) => parseFloat(a.productPrice) > parseFloat(b.productPrice) ? 1 : -1).map(d => ({ ...d, isInStock: true })).map(d => (\r\n          <DataItem dataItem={d} key={d.id} />\r\n        ))}\r\n      </div>\r\n      <h1 className=\"heading\">Información en directo</h1>\r\n      <div className=\"data\">\r\n        {loading ? 'Recuperando datos...' : data.sort((a, b) => a.date > b.date ? -1 : 1).map(d => (\r\n          <DataItem dataItem={d} key={d.id} />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  )\r\n}","import './reset.scss';\r\nimport './App.scss';\r\n\r\nimport { Routes, Route, Link } from \"react-router-dom\";\r\nimport { useEffect, useState } from 'react'\r\nimport { signInWithRedirect, GoogleAuthProvider, signOut, onAuthStateChanged } from 'firebase/auth'\r\nimport { auth } from './lib/firebase';\r\nimport { Products } from './views/products';\r\nimport { Home } from './views/home';\r\n\r\n\r\nfunction App() {\r\n\r\n  const [loggedIn, setLoggedIn] = useState()\r\n  const [isAdmin, setIsAdmin] = useState(false)\r\n\r\n  useEffect(() => {\r\n    onAuthStateChanged(auth, user => {\r\n      if (user) {\r\n        if (user.uid === \"7Xhp5BspVFNqxngdLYKk5C9Hzm62\") setIsAdmin(true)\r\n        setLoggedIn(true)\r\n      } else {\r\n        setIsAdmin(false)\r\n        setLoggedIn(false)\r\n      }\r\n    })\r\n  }, [])\r\n\r\n  return (\r\n    <div className=\"app\">\r\n      {loggedIn === true ? <button className=\"red\" onClick={() => signOut(auth)} type=\"button\">logout</button> : loggedIn === false ? <button className=\"blue\" onClick={() => signInWithRedirect(auth, new GoogleAuthProvider())} type=\"button\">login</button> : 'Checking your session...'}\r\n      {isAdmin &&\r\n        <nav>\r\n          <Link to=\"/stock-checker-site\">Home</Link>\r\n          <Link to=\"/stock-checker-site/products\">Products</Link>\r\n        </nav>\r\n      }\r\n      <Routes>\r\n        <Route path=\"/stock-checker-site\" element={<Home />} />\r\n        {isAdmin && <Route path=\"/stock-checker-site/products\" element={<Products />} />}\r\n      </Routes>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","const reportWebVitals = onPerfEntry => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.scss';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport { BrowserRouter } from \"react-router-dom\";\r\n\r\nReactDOM.render(\r\n  <BrowserRouter>\r\n    <App />\r\n  </BrowserRouter>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}